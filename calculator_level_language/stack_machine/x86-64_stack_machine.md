# 以x86-64實作堆疊機的方法

目前為止討論的都是假想的堆疊機。真正的x86-64並不是堆疊機，而是暫存器機（register machine）。x86-64的運算多半是針對2個暫存器間定義的，並不是對堆疊頂端的2個元素定義。因此，想要把堆疊機的技巧用在x86-64上的話，就要用某些方法以暫存器機來模擬堆疊機才行。

用暫存器機來模擬堆疊機是相對簡單的。只要把堆疊機1個指令完成的動作用複數指令來實作就可以了。

接下來我們來說明怎麼做的具體方法：

首先，準備1個表示堆疊頂端的暫存器，這個暫存器稱為堆疊指標。如果想從堆疊取出2個值的話，就是從堆疊指標所指的位置取出2個元素，然後根據取出的要素數量去改編堆疊指標所指的位置。同理，推入堆疊時就是在寫入堆疊指標所指的記憶體的同時去改變其指標值。



